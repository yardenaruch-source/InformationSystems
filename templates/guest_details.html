{% extends "base.html" %}
{% block title %}Guest Details{% endblock %}
{% block flashes %}{% endblock %}

{% block content %}
<section class="board narrow-board">
  <h1>Guest Details</h1>

  <div class="flash-wrap">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="flash flash-{{ category }}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  <form method="post" class="form" style="margin-top:12px;">
    <input type="hidden" name="next" value="{{ next_url }}">

    <label for="email">Email</label>
    <input id="email" type="email" name="email" placeholder="name@example.com" required value="{{ form.email or '' }}">

    <label for="full_name">Full name (English)</label>
    <input id="full_name" type="text" name="full_name" required
           placeholder="e.g. Maya Oren"
           value="{{ form.full_name or '' }}">

    <label for="passport_id">Passport ID</label>
    <input id="passport_id" type="text" name="passport_id" maxlength="9" placeholder="9 characters" required
           value="{{ form.passport_id or '' }}">

    <label>Phone numbers</label>

    <div id="phones-wrap" style="display:flex; flex-direction:column; gap:10px;">
      {# render existing phones if form re-rendered #}
      {% if form.phones and form.phones|length > 0 %}
        {% for p in form.phones %}
          <input type="text" name="phone" placeholder="e.g. 054-1234567" required
             pattern="^[0-9-]+$" inputmode="numeric"
             title="Only digits and '-' are allowed"
             value="{{ p }}">
        {% endfor %}
      {% else %}
        <input type="text" name="phone" placeholder="e.g. 054-1234567" required
           pattern="^[0-9-]+$" inputmode="numeric"
           title="Only digits and '-' are allowed">
      {% endif %}
    </div>

    <button type="button" class="btn" id="add-phone-btn" style="margin-top:8px;">
      + Add phone number
    </button>

    <button class="btn" type="submit" style="margin-top:12px;">Continue</button>
  </form>
</section>

<script>
  document.getElementById("add-phone-btn").addEventListener("click", () => {
    const wrap = document.getElementById("phones-wrap");
    const inp = document.createElement("input");

    inp.type = "text";
    inp.name = "phone";
    inp.placeholder = "e.g. 054-1234567";
    inp.required = true;

    /* âœ… add validation here */
    inp.pattern = "^[0-9-]+$";
    inp.inputMode = "numeric";
    inp.title = "Only digits and '-' are allowed";

    wrap.appendChild(inp);
  });
</script>

{% endblock %}