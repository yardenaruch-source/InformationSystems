{% extends "base.html" %}
{% block title %}Add Flight{% endblock %}

{% block content %}
<section class="board narrow-board">
  <h2 style="text-align: center;">Add Flight</h2>

  <form method="post" class="form" style="margin-top:12px; max-width:720px;">

    <label class="field-label">Flight ID</label>
    <input class="field-input" name="flight_id" placeholder="e.g. F1234" required>

    <label class="field-label">Route</label>
    <select class="field-input" name="route_id" required>
      {% for r in routes %}
        <option value="{{ r.route_id }}">{{ r.route_id }} — {{ r.origin_airport }} → {{ r.destination_airport }}</option>
      {% endfor %}
    </select>

    <label class="field-label">Flight Duration (minutes)</label>
    <input class="field-input" id="flight_duration" type="text" readonly>

    <label class="field-label">Plane</label>
    <select class="field-input" name="plane_id" required>
      {% for p in planes %}
        <option value="{{ p }}">{{ p }}</option>
      {% endfor %}
    </select>

    <label class="field-label">Manager</label>
    <select class="field-input" name="manager_id" required>
      {% for m in managers %}
        <option value="{{ m.employee_id }}">{{ m.employee_id }} — {{ m.employee_first_name }} {{ m.employee_last_name }}</option>
      {% endfor %}
    </select>

    <label class="field-label">Takeoff Date</label>
    <input class="field-input" type="date" name="takeoff_date" required>

    <label class="field-label">Takeoff Time</label>
    <input class="field-input" type="time" name="takeoff_time" required>

    <hr style="margin:18px 0; opacity:0.35;">

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
      <div class="card" style="padding:12px;">
        <b>Economy</b>
        <label class="field-label">Price</label>
        <input class="field-input" type="number" step="0.01" min="0" name="econ_price" placeholder="e.g. 399.00">

        <label class="field-label">Rows</label>
        <input class="field-input" id="econ_rows" type="text" readonly>

        <label class="field-label">Columns</label>
        <input class="field-input" id="econ_cols" type="text" readonly>
      </div>

      <div class="card" style="padding:12px;">
        <b>Business</b>
        <label class="field-label">Price</label>
        <input class="field-input" type="number" step="0.01" min="0" name="bus_price" placeholder="e.g. 999.00">

        <label class="field-label">Rows</label>
        <input class="field-input" id="bus_rows" type="text" readonly>

        <label class="field-label">Columns</label>
        <input class="field-input" id="bus_cols" type="text" readonly>
      </div>
    </div>

    <div style="justify-content:center; display:flex; gap:10px; margin-top:14px;">
      <button class="btn" type="submit">Create Flight</button>
    </div>
  </form>
</section>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const layoutMap = {{ layout_map|tojson }};
  const routeMap  = {{ route_map|tojson }};

  const planeSelect = document.querySelector('select[name="plane_id"]');
  const routeSelect = document.querySelector('select[name="route_id"]');

  function setVal(id, val) {
    const el = document.getElementById(id);
    if (el) el.value = (val ?? "-");
  }

  function updateLayout() {
    if (!planeSelect) return;
    const pid = planeSelect.value;
    const econ = layoutMap?.[pid]?.["Economy"];
    const bus  = layoutMap?.[pid]?.["Business"];
    setVal("econ_rows", econ?.rows);
    setVal("econ_cols", econ?.cols);
    setVal("bus_rows",  bus?.rows);
    setVal("bus_cols",  bus?.cols);
  }

  function updateDuration() {
    if (!routeSelect) return;
    const rid = routeSelect.value;     // string
    setVal("flight_duration", routeMap?.[rid]);
  }

  if (planeSelect) {
    planeSelect.addEventListener("change", updateLayout);
    updateLayout();
  }

  if (routeSelect) {
    routeSelect.addEventListener("change", updateDuration);
    updateDuration();
  }
});
</script>

{% endblock %}


