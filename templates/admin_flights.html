{% extends "base.html" %}
{% block title %}Admin flights{% endblock %}

{% block content %}
<section class="board admin-box">
    <h1 style="text-align:center; margin-top: -2px; margin-bottom: 28px;">Control Panel</h1>

    <div class="card admin-actions-box">
    <div class="admin-actions">
      <a class="btn" href="{{ url_for('admin_add_plane') }}">+ Add Plane</a>
      <a class="btn" href="{{ url_for('admin_add_route') }}">+ Add Route</a>
      <a class="btn" href="{{ url_for('admin_add_flight') }}">+ Add Flight</a>
    </div>
  </div>
</section>

<section class="board admin-box">
  <h1 style="text-align:center;">Flights</h1>

  <form method="get" class="form admin-filter">
    <label for="flight_id">Flight ID</label>
    <input id="flight_id" name="flight_id" value="{{ filters.flight_id }}" placeholder="e.g. F1234">

    <label for="status">Status</label>
    <select id="status" name="status">
      <option value="" {% if not filters.status %}selected{% endif %}>All</option>
      <option value="Scheduled" {% if filters.status=='Scheduled' %}selected{% endif %}>Scheduled</option>
      <option value="Full" {% if filters.status=='Full' %}selected{% endif %}>Full</option>
      <option value="Completed" {% if filters.status=='Completed' %}selected{% endif %}>Completed</option>
      <option value="Cancelled" {% if filters.status=='Cancelled' %}selected{% endif %}>Cancelled</option>
    </select>

    <label for="takeoff_date">Takeoff Date</label>
    <input id="takeoff_date" type="date" name="takeoff_date" value="{{ filters.takeoff_date }}">

    <div class="admin-filter-actions">
      <button class="btn" type="submit">Filter</button>
      <a class="btn" href="{{ url_for('admin_flights') }}">Reset</a>
    </div>
  </form>

  <div class="board-table-wrap">
    <table class="board-table">
      <thead>
        <tr>
          <th>Flight</th>
          <th>Route</th>
          <th>Takeoff Date</th>
          <th>Takeoff Time</th>
          <th>Landing Date</th>
          <th>Landing Time</th>
          <th>Status</th>
          <th>Plane</th>
          <th>Manager</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
      {% if flights and flights|length > 0 %}
        {% for f in flights %}
        <tr>
          <td>{{ f.flight_id }}</td>
          <td>{{ f.origin_airport }} → {{ f.destination_airport }}</td>
          <td>{{ f.takeoff_date }}</td>
          <td>{{ f.takeoff_time }}</td>
          <td>{{ f.landing_date }}</td>
          <td>{{ f.landing_time }}</td>
          <td>{{ f.flight_status }}</td>
          <td>{{ f.plane_id }}</td>
          <td>{{ f.manager_id }}</td>
          <td>
            {% if (f.flight_status == 'Full' or f.flight_status == 'Scheduled') and f.can_cancel_72h %}
              <form method="post"
                    action="{{ url_for('admin_cancel_flight', flight_id=f.flight_id) }}"
                    onsubmit="return confirm('Cancel flight {{ f.flight_id }}?');">
                <button class="btn" type="submit">Cancel</button>
              </form>
            {% else %}
              <span class="muted">—</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="10" class="empty-row">No flights found.</td></tr>
      {% endif %}
      </tbody>
    </table>
  </div>

</section>
{% endblock %}